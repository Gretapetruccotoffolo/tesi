import pandas as pd

# Legge il file
df = pd.read_csv("COD_CPUE_with_area.csv")

# Rinomina la colonna CPUE se serve
if 'CPUE_number_per_hour' not in df.columns and 'CPUE_number_per_hour' in df.columns:
    df.rename(columns={'CPUE_number_per_hour': 'CPUE_number_per_hour'}, inplace=True)

# Raggruppa per Year, SubArea, LngtClass
grouped = df.groupby(['Year', 'SubArea', 'LngtClass'], as_index=False).agg({
    'Area_km2': 'first',                     # l’area è uguale per tutti i duplicati
    'HaulDur': 'mean',                       # media se ci sono più righe
    'CPUE_number_per_hour': 'mean'           # media se ci sono più righe
})

# Salva il risultato
grouped.to_csv("CPUE_deduplicato.csv", index=False)

print("✅ File creato: CPUE_deduplicato.csv")






import pandas as pd

# Carica il file creato in precedenza
df = pd.read_csv("CPUE_deduplicato.csv")

# Calcola W
a = 0.007
b = 3
df["W"] = a * (df["LngtClass"] / 10) ** b

# Calcola Numero
df["Numero"] = df["CPUE_number_per_hour"] * (df["HaulDur"] / 60) * (df["Area_km2"] / 0.068484)

# Seleziona solo le colonne richieste
output_df = df[["Year", "SubArea", "W", "Numero"]]

# Salva il nuovo file
output_df.to_csv("CPUE_con_W_e_Numero.csv", index=False)

print("✅ File creato: CPUE_con_W_e_Numero.csv")






import pandas as pd

# Carica il file
df = pd.read_csv("CPUE_con_W_e_Numero.csv")

# Calcola W_lngt
df["W_lngt"] = (df["W"] * df["Numero"]) / 1_000_000

# Somma per Year e SubArea → W_sub
w_sub = df.groupby(["Year", "SubArea"], as_index=False)["W_lngt"].sum()

# Somma per Year → W_NS
w_ns = w_sub.groupby("Year", as_index=False)["W_lngt"].sum()
w_ns.rename(columns={"W_lngt": "W_NS"}, inplace=True)

# Salva il file
w_ns.to_csv("Biomassa_Annua_NS.csv", index=False)

print("✅ File creato: Biomassa_Annua_NS.csv")
